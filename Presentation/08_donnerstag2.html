<!DOCTYPE html>
<html>
  <head>
    <title>C++ For (8) - Donnerstag Teil 2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="CSS/styling.css" />
    <!-- when changing the stylesheet, please also change EACH 'styling-by:' -->
  </head>
  <body>
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<!-- :::::::::: template pages come first ... skip to REALCONTENT ::::::::: -->
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<textarea id="source">

layout: true
name: blank
styling: styling.css
styling-by: Martin Weitzel

<!--
  *****************************************************************************
  Template used for title page (only)
  *****************************************************************************
  Please change the 'styling-by:' attribute if you change the style-sheet.
-->

.stylehint[
Styled with [{{styling}}]({{styling}}) by {{styling-by}}
]

---
layout: true
name: plain
copyright: (CC) BY-SA
branding:  [Dipl.-Ing. Martin Weitzel](http://tbfe.de)
customer:  [im Auftrag von MicroConsult Training & Consulting GmbH](http://microconsult.de)

<!--
  *****************************************************************************
  Template used for for pages NOT referring to any Info-Graphic
  *****************************************************************************
  The following attributes are mandatory FOR THE TEMPLATE PAGE and should
  simply be left empty if not meaningful.

  copyright: will be reproduced in each page footer first
  branding: will reproduced in each page footer next
  customer: will be reproduced in each page footer last

  As the above attributes are part of several page templates a global replace
  should be used for consistent changes.

  On pages USING THIS TEMPLATE the following attributes must be set:

  header: ## and header text (i.e. including the markdown formatting indicator)

-->

{{header}}

.pagefooter[
{{copyright}}: {{branding}} {{customer}} .microconsult-logo[]
]

---
layout: true
name: linkinfo
copyright: (CC) BY-SA
branding:  [Dipl.-Ing. Martin Weitzel](http://tbfe.de)
customer:  [im Auftrag von MicroConsult Training & Consulting GmbH](http://microconsult.de)

<!--
  *****************************************************************************
  Template used for for pages INTRODUCING to a new Info-Graphic
  *****************************************************************************
  On this kind of pages a size-reduced version of the whole info graphic will
  be reproduced and occupies aproximately 2/3 of the page width. So only add
  little information, preferrably links to later pages dealing with single
  sections of the info graphic.

  On pages USING THIS TEMPLATE the following attributes must be set:

  graphic: file path to of the infographic EXCLUDING the suffix.
  header: ## and header text (i.e. including the markdown formatting indicator)

-->

{{header}}

.infographic[
[![Info-Grafik](InfoGraphics/{{graphic}}.png)](InfoGraphics/{{graphic}}.png
                "Click to open - add [CTRL+] SHIFT for new [tabbed] window")
]

.pagefooter[
{{copyright}}: {{branding}} {{customer}} .microconsult-logo[]
]

---
layout: true
name: withinfo
copyright: (CC) BY-SA
branding:  [Dipl.-Ing. Martin Weitzel](http://tbfe.de)
customer:  [im Auftrag von MicroConsult Training & Consulting GmbH](http://microconsult.de)

<!--
  *****************************************************************************
  Template used for pages dealing with a SPECIFIC SECTION of an Info-Graphic
  *****************************************************************************
  On such pages a link to the info graphic is reproduced in the top-right
  corner (or maybe elsewhere depending on the style sheet), so there are no
  restrictions with respect to the space available for the content of the page.

  On pages USING THIS TEMPLATE the following attributes must be set:

  graphic: file path to of the info graphic EXCLUDING the suffix and
  section: specific section in the info graphic this page refers to
  header: ## and header text (i.e. including the markdown formatting indicator)
-->

{{header}}

.infolink.right[
[Click here for Info-Graphic  
{{graphic}}](InfoGraphics/{{graphic}}.png "add [CTRL+] SHIFT for own [tabbed] window")  
{{section}}
]

.pagefooter[
{{copyright}}: {{branding}} {{customer}} .microconsult-logo[]
]

<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<!-- end of templates ... below comes the REALCONTENT - TNETNOCLAER ends it -->
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
---
layout: false
template: blank

  [C++ FOR]: 00_inhalt.html#agenda

# [C++ FOR] (Donnerstagnachmittag)

-------------------------------------------------------------------------------

1. [Grundlegendes zu Exceptions			](#exception_basics)
1. [Richtlinien für den Exception-Einsatz	](#exception_details)
1. [Übung					](#exercise_thu2)

-------------------------------------------------------------------------------

Kürzere Pausen werden jeweils nach Bedarf eingelegt.

Die Besprechung der Musterlösung(en) erfolgt zu Beginn des folgenden Vormittags.

---
template: linkinfo
graphic: ExceptionBasics
name: exception_basics
header: ## Grundlegendes zu Exceptions

-------------------------------------------------------------------------------

* [Hierarchien von Exception-Klassen		](#exception_hierarchies)

-------------------------------------------------------------------------------

* [Kontrollfluss mit und ohne Exceptions	](#exception_flowcontrol)

-------------------------------------------------------------------------------

* [Exception Klassen als "Label" verstanden	](#exception_as_label)
* [Gruppieren ähnlicher Exceptions 		](#exception_grouping)
* [Aktivieren eines Behandlungs-Blocks		](#exception_try_block)

-------------------------------------------------------------------------------

* [Unvollständig behandelte Exceptions		](#exception_rethrow)
* [Fangen aller Exceptions			](#exception_catchall)

---
template: withinfo
graphic: ExceptionBasics
section: Exception Class Hierarchies
name: exception_hierarchies
header: ### Hierarchien von Exception-Klassen

Die im Rahmen von Bibliotheksfuntionen ggf. geworfenen Exceptions bilden eine
Klassenhierarchie:

* An deren Spitze steht die Klasse `std::exception`.

* Weitere Klassen sind oft als Basisklassen für eigene Exception-Klassen
  sinnvoll, etwa

  * `std::logic_error` oder

  * `std::runtime_error`.

---
template: withinfo
graphic: ExceptionBasics
section: Execution Path taken for Exception
name: exception_flowcontrol
header: ### Kontrollfluss mit und ohne Exception

Solange keine Exceptions geworfen werden,

* folgt der Kontrollfluss den üblichen Regeln, und

* alle auf `try`-Blöcke folgenden `catch`-Blöcke werden übersprungen.

---
template: withinfo
graphic: ExceptionBasics
section: Exception Classes Viewn as Labels
name: exception_as_label
header: ### Exception Klassen als "Label" verstanden

Sobald eine `throw`-Anweisung ausgeführt wird, stellen die den aktiven
`try`-Blöcken nachfolgenden `catch`-Blöcke eine Art Label dar:

* Verzweigt wird grundsätzlich im Kontrollfluss rückwärts, also in Richtung
  auf die `main`-Funktion.

* Die Auswahl der `catch`-Blöcke erfolgt dabei
  * gemäß der dynamischen Schachtelung der Funktionsaufrufe, und
  * dort ggf. für die einen einzelnen `catch-`Blöcke` von oben nach unten.

* Der erste `catch`-Block, bei dem der Typ des "Arguments" der `catch`-Anweisung
  zum Typ der geworfenen Exception passt, wird gewählt.

---
template: withinfo
graphic: ExceptionBasics
section: Grouping Exceptions
name: exception_grouping
header: ### Gruppieren ähnlicher Exceptions

Bei der Auswahl des `catch`-Blocks werden in Bezug auf den Typ der geworfenen
Exceptions auch mögliche Umwandlungen berücksichtigt:

* Prinzipiell gelten die selben Umwandlungen wie bei der Parameterübergabe im
  Rahmen von Funktionsaufrufen.

* Insbesondere gilt das LSP:

  * abgeleitete Klassen passen zu ihren jeweiligen Basisklassen.

* Dies macht es sinnvoll, ähnliche Exceptions mittels kleiner oder größerer
  Klassenhierarchien zusammenzufassen.

---
template: withinfo
graphic: ExceptionBasics
section: Enabling Handler Blocks
name: exception_try_block
header: ### Aktivieren der Ausnahmebehandlung

Als Sprungziel in Frage kommen die **aktiven** `catch`-Blöcke.

* Das sind alle `catch`-Blöcke,

  * deren vorangehender `try`-Block vom Kontrollfluss erreicht ...

  * ... und noch nicht wieder verlassen wurde.

.N[
Ein `try`-Block ist nicht mehr aktiv, wenn er explizit verlassen wird durch

* `return`
* `break`
* `continue`

oder die letzte enthaltene Anweisung vollständig ausgeführt wurde.
]

Ab diesem Moment werden auch die nachfolgenden `catch`-Blöcke nicht mehr als
"Sprungziel" für ein `throw` in Betracht gezogen.

---
template: withinfo
graphic: ExceptionBasics
section: Re-throw Exceptions
name: exception_rethrow
header: ### Unvollständig behandelte Exceptions

Catch-Blöcke, welche nur eine teilweise Auflösung der Fehlersituation leisten,
können die gefangene Exception erneut werfen:
```
    try {
        …
        … // code that may throw SomeException
        …
    }
    catch (SomeException &ex) {
        …
        … // partial recovery only
        …
        throw;
    }
}
```

---
template: withinfo
graphic: ExceptionBasics
section: Catch Any Exception
name: exception_catchall
header: ### Fangen aller Exceptions

Es besteht die Möglichkeit, einen `catch`-Block für alle erdenklichen
Exception "passend" zu machen:

* Hierzu sind in den runden Klammern drei Punkte (analog zu variadischen
  Funktionen) anzugeben.

  * Ein solcher Block sollte immer am Ende aller `catch`-Blöcke zu einem
    `try`-Block stehen.

  * Andernfalls gilt er vorrangig zu spezifischeren, nachfolgenden
    `catch`-Blöcken des selben `try`-Blocks.

```
int main() {
    try {
        …
        …
    }
    catch (...) {
        std::cerr << "!! unhandled exception !!\n";
    }
}
```

---
template: linkinfo
graphic: ExceptionDetails
name: exception_details
header: ## Richtlinien für den Exception-Einsatz

-------------------------------------------------------------------------------

* [(Keine) isolierte Klassenhierarchie	](#disconnected_class_hierarchy)

-------------------------------------------------------------------------------

* [(Falsche) Behandlungsblock-Abfolge	](#wrong_catch_order)

-------------------------------------------------------------------------------

* [Optimale Weiterleitung		](#correct_rethrow)
  * [(Rückschnitt auf Basisklasse)	](#avoidable_copy_slicing)
  * [(Sub-optimale Weiterleitung)	](#problematic_rethrow)

-------------------------------------------------------------------------------

* [Exceptions in Destruktoren vermeiden	](#dtor_exception_nogo)

-------------------------------------------------------------------------------

---
template: withinfo
graphic: ExceptionDetails
section: (No) Disconnected Class Hierarchy
name: disconnected_class_hierarchy
header: ### (Keine) isolierte Klassenhierarchie

Bilden eigene Exceptions eine isolierte Klassenhierarchie, so kann (sehr
allgemeiner) Code diese **nicht** über Standard-Exceptions abfangen:

```
int main() {
    using namespace std;
    try {
        …
        … // ordinary application
        …
        return EXIT_SUCCESS; // macro in <cstdlib>
    }
    catch (exception &e) {
        cerr << "terminated by standard exception: "
             << e.what() << endl;
    }
    catch (...) {
        cerr << "terminated by unknown exception" << endl;
    }
    return EXIT_FAILURE; // macro in <cstdlib>
}
```

---
template: withinfo
graphic: ExceptionDetails
section: (Bad) Order of Handlers
name: wrong_catch_order
header: ### (Falsche) Behandlungsblock-Abfolge

Werden die `catch`-Blöcke für Exceptions falsch angeordnet,

* kann ein weiter oben stehender, allgemeiner Block

* einen weiter unter stehenden, spezifischeren Block unwirksam machen.

---
template: withinfo
graphic: ExceptionDetails
section: Optimal Re-Throwing
name: correct_rethrow
header: ### Optimale Weiterleitung

Das Weiterwerfen eines gefangenen Exception-Objekts mit
```
…
catch (SomeException &ex) {
    …
    // only partial recovery
    throw ex;
}
```

führt zur Erstellung einer Kopie **im Rahmen der Anweisung `throw ex;`**

.N[
Mit `throw;` kann das ursprünglich gefangene Exception-Objekt **ohne Kopieren**
weitergeworfen werden.
]

---
template: withinfo
graphic: ExceptionDetails
section: Sclicing Exception Object
name: avoidable_copy_slicing
header: ### (Vermeidbarer) Rückschnitt auf Basisklasse

Durch (vermeidbares) Kopieren des Exception-Objekts können geworfene
Exceptions einer abgeleiteten Klasse per Slicing auf die Basisklasse
reduziert werden.

**Dies ist im Allgemenen nicht wünchenswert.**

Daher sollte ein Kopieren vermieden werden:

* Argumente von `catch`-Blöcken als Referenz spezifizieren.

* Bei nur teilweise Auflösung Exception mit `throw;` weiterwerfen.

---
template: withinfo
graphic: ExceptionDetails
section: Sub-optimal Re-throwing
name: problematic_rethrow
header: ### Sub-optimale Weiterleitung

Sub-optimal ist grundsätzlich jede Weiterleitung, bei der das Exception-Objekt
unnötig kopiert wird.

---
template: withinfo
graphic: ExceptionDetails
section: (No) Throwing from Destructoes
name: dtor_exception_nogo
header: ### (Keine) Exceptions aus Destruktoren werfen

.W[
Exceptions, die von Destruktoren geworfen werden, können ein Programm abbrechen,
wenn der Destruktor im Rahmen eines Exception-Handlings ausgeführt wird.
]

Falls ein Destruktor Operationen benutzen muss, die u.U. eine Exception
auslösen, sollte der Code sicherheitshalber in einen `try`-Block verpackt
werden, der alle Exceptions fängt und ignoriert:._[]
```
class MyClass {
    …
    ~MyClass() {
        try {
            … // whatever needs be done
        }
        catch (...) {
            if (!std::uncaught_exception()) throw;
        }
    }
}; 
```
.F[:
Ob es tatsächlich sinnvoll ist, die Exception wie gezeigt weiterzuwerfen, falls
der Destruktor **nicht** im Rahmen eines Exceptions-Handlings abläuft, muss je
nach Sachlage individuell entschieden werden.
]

---
template: plain
name: no_more_throwspec
header: ## `throw`-Spezifikationen vermeiden

Nachdem über viele Jahre hinweg von C++-Experten praktisch einhellig empfohlen
worden war, die seinerzeit von C++98 eingeführten `throw`-Spezifikationen zu
vermeiden, wurden diese nun mit C++11 zum *deprecated feature*.

---
template: plain
name: noexcept
header: ## Exception-Freiheit mit `noexcept` ankündigen

Neu eingeführt wurde mit C++11 die `noexcept`-Qualifikation für Funktionen,
welche folgendes bewirkt:

* Wirft eine damit qualifizierte Funktion dennoch eine Exception, kommt es zum
  unwiderruflichen Prgrammabbruch (nach Durchlaufen eines frei festzulegenden
  Handlers).

* Andere Funktionen betrachten eine mit `noexcept` qualifzierte Funktion als
  *aufrufbar ohne Risiko, dass es zu einer Exceptions kommt*.._[]

.N[
Insgesamt liegen mit der Umsetzung von `noexcept` durch gängige Compiler noch
zu wenige Erfahrungen vor, um eindeutige Richtlinien und Empfehlungen zur
Benutzung dieses Features geben zu können.
]

.F[:
Dies ist insofern richtig, als Exceptions – treten Sie dennoch auf – prakisch
unmittelbar zum Programmabbruch führen, d.h. im Kontext des Aufrufs muss die
Möglichkeit von Exceptions bei solchen Funktionen in der Tat nicht berücksichigt
werden ... dennoch wird u.U. das Programm abgebrochen.
]

---
template: plain
name: noexcept
header: ## Bedingte Exception-Freiheit mit `noexcept`

Über das auf der vorhergenden Seite gesagte hinaus ist `noxecept` auch eine
Compilezeit-Funktion, mit welcher – insbesondere in Templates – die **bedingte
Freiheit Exceptions** deklariert werden kann.

* Hiermit kann eine Funktion zum Ausdruck bringen, dass Exceptions nur dann
  auftreten werden, wenn bestimmte aufgerufene Funktinen solche werfen.

* Dadurch kann zur Compilezeit bei der Instanziierung von Templates mit
  konkreten Typen entschieden werden, ob bei einer bestimmten Operation das
  Risiko von Exceptions besteht.

* Dies eröffnet letztlich die Möglichkeit, dass Bibliotheksfunktionen über
  Template-Metaprogrammierung unterschiedliche Implementierungen wählen.

---
template: plain
name: exercise_thu2
header: ## Übung

Ziel der Aufgabe:

Erweiterung einer Klasse mit einer Fehlerbehandlung unter Nutzung von Exceptions.._[]

.N[
Weitere Details werden vom Dozenten anhand des Aufgabenblatts sowie der
vorbereiteten Eclipse-Projekte erläutert.
]

.F[:
Diese Aufgabe bietet über die Anwendung von Exceptions hinausgehend auch noch
die Möglichkeit, entweder mit Hilfe virtueller Member-Funktionen oder mit Hilfe
von Templates eine besonders flexible Lösung zu schaffen.
]

</textarea>
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<!-- ::::::::::::::::::::: )-: ereh TNETNOCLAER fo dne :::::::::::::::::::: -->
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
    <script src="remark.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({ highlightLanguage: 'cpp', highlightStyle: 'docco' });
    </script>
  </body>
</html>
